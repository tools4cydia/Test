import os
import subprocess
from flask import Flask, request, send_file

app = Flask(__name__)

@app.route('/convert-deb-to-ipa', methods=['POST'])
def convert_deb_to_ipa():
    deb_file = request.files['debFile']
    deb_file.save('input.deb')

    # فك ملف .deb
    os.system('dpkg-deb -x input.deb temp/')
    os.system('dpkg-deb -e input.deb temp/DEBIAN')

    # إنشاء هيكل ملف .ipa
    os.makedirs('Payload/YourApp.app', exist_ok=True)
    os.system('mv temp/* Payload/YourApp.app/')

    # ضغط الملف كـ .ipa
    os.system('zip -r output.ipa Payload/')

    # توقيع الملف
    os.system('ldid -S Payload/YourApp.app/YourApp')

    # إرسال الملف المحول
    return send_file('output.ipa', as_attachment=True)

if __name__ == "__main__":
    app.run()
